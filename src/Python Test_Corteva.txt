Overview
--------

This coding exercise will help us understand how you approach some of the common problems we see in data engineering. Ask questions if things are unclear, use best practices and common software patterns, and feel free to go the extra mile to show off your skills. Imagine you are handing off your completed project to someone else to maintain -- it should be clear to another developer how things work and your reasoning behind your design decisions.

You will be asked to ingest some weather and crop yield data (provided), design a database schema for it, and expose the data through a REST API. You may use whatever software tools you would like to answer the problems below, but keep in mind the skills required for the position you are applying for and how best to demonstrate them. Read through all the problems before beginning, as later problems may inform your approach to earlier problems.

You can retrieve the data required for this exercise by cloning this repository:
https://github.com/corteva/code-challenge-template

Weather Data Description
------------------------

The wx_data directory has files containing weather data records from 1985-01-01 to 2014-12-31. Each file corresponds to a particular weather station from Nebraska, Iowa, Illinois, Indiana, or Ohio.

Each line in the file contains 4 records separated by tabs: 

1. The date (YYYYMMDD format)
2. The maximum temperature for that day (in tenths of a degree Celsius)
3. The minimum temperature for that day (in tenths of a degree Celsius)
4. The amount of precipitation for that day (in tenths of a millimeter)

Missing values are indicated by the value -9999.

Problem 1 - Data Modeling
-------------------------
Choose a database to use for this coding exercise (SQLite, Postgres, etc.). Design a data model to represent the weather data records. If you use an ORM, your answer should be in the form of that ORM's data definition format. If you use pure SQL, your answer should be in the form of DDL statements.

Problem 2 - Ingestion
---------------------
Write code to ingest the weather data from the raw text files supplied into your database, using the model you designed. Check for duplicates: if your code is run twice, you should not end up with multiple rows with the same data in your database. Your code should also produce log output indicating start and end times and number of records ingested.

Problem 3 - Data Analysis
-------------------------
For every year, for every weather station, calculate:

* Average maximum temperature (in degrees Celsius)
* Average minimum temperature (in degrees Celsius)
* Total accumulated precipitation (in centimeters)

Ignore missing data when calculating these statistics.

Design a new data model to store the results. Use NULL for statistics that cannot be calculated.

Your answer should include the new model definition as well as the code used to calculate the new values and store them in the database.

Problem 4 - REST API
--------------------
Choose a web framework (e.g. Flask, Django REST Framework). Create a REST API with the following GET endpoints:

/api/weather
/api/weather/stats

Both endpoints should return a JSON-formatted response with a representation of the ingested/calculated data in your database. Allow clients to filter the response by date and station ID (where present) using the query string. Data should be paginated.

Include a Swagger/OpenAPI endpoint that provides automatic documentation of your API.

Your answer should include all files necessary to run your API locally, along with any unit tests.

Extra Credit - Deployment
-------------------------
(Optional.) Assume you are asked to get your code running in the cloud using AWS. What tools and AWS services would you use to deploy the API, database, and a scheduled version of your data ingestion code? Write up a description of your approach.

---

Submitting Your Answers
-----------------------
Consider using a linter, code formatter, and including tests and code comments. Anything that helps us understand your thought process is helpful!
Please provide us with a link to your Git repository, hosted on GitHub/GitLab, containing your answers and code.


----------------------------


weather_station,weather_record,weather_ingest_log,weather_statistics


CREATE TABLE IF NOT EXISTS public.weather_record (
    record_id SERIAL PRIMARY KEY,
    station_id INTEGER NOT NULL REFERENCES weather_station(station_id) ON DELETE CASCADE,
    record_date DATE NOT NULL,
    max_temp INTEGER,
    min_temp INTEGER,
    precipitation INTEGER,
    CONSTRAINT unique_station_date UNIQUE (station_id, record_date)
);

CREATE TABLE IF NOT EXISTS public.weather_station (
    station_id SERIAL PRIMARY KEY,
    station_code VARCHAR(20) UNIQUE NOT NULL,
    state CHAR(2) NOT NULL
);

CREATE TABLE IF NOT EXISTS weather_ingest_log (
    log_id SERIAL PRIMARY KEY,
    station_code VARCHAR(20),
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    records_ingested INTEGER
);

CREATE TABLE IF NOT EXISTS weather_statistics (
    station_id INTEGER NOT NULL REFERENCES weather_station(station_id) ON DELETE CASCADE,
    year INTEGER NOT NULL,
    avg_max_temp_celsius NUMERIC(5, 2),
    avg_min_temp_celsius NUMERIC(5, 2),
    total_precipitation_cm NUMERIC(7, 2),
    PRIMARY KEY (station_id, year)
);



----------------------------


django-admin startproject weatherapi
cd weatherapi
python manage.py startapp api
python manage.py runserver


Test:

Daily records
http://127.0.0.1:8000/api/weather?station_id=1&date_from=1985-01-01&date_to=1985-01-31&page=1

Yearly stats
http://127.0.0.1:8000/api/weather/stats?station_id=1&year_from=1985&year_to=1990&page=1

Swagger UI: 
http://127.0.0.1:8000/api/docs/

